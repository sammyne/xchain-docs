(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{357:function(s,t,a){s.exports=a.p+"assets/img/block-img.e372d8a5.png"},358:function(s,t,a){s.exports=a.p+"assets/img/tx-img.3a55bece.png"},359:function(s,t,a){s.exports=a.p+"assets/img/xupermodel.de371488.png"},377:function(s,t,a){"use strict";a.r(t);var n=a(42),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_3-核心数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-核心数据结构"}},[s._v("#")]),s._v(" 3. 核心数据结构")]),s._v(" "),n("h2",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),n("p",[s._v("众所周知，程序=数据结构+算法，了解一个程序的数据结构有助于掌握一个程序的关键设计。本文从背景、功能以及各个字段的用意来剖析XuperChain底层核心数据结构，从而方便XuperChain开发者以及用户更深入地了解XuperChain底层框架的核心数据结构的设计缘由，有助于提高XuperChain开发者更高效的开发，有助于XuperChain用户更好的使用XuperChain来服务自己的业务。")]),s._v(" "),n("h2",{attrs:{id:"核心数据结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心数据结构"}},[s._v("#")]),s._v(" 核心数据结构")]),s._v(" "),n("p",[s._v("涉及到的核心数据结构包括：区块、交易、UTXO、读写集。")]),s._v(" "),n("h3",{attrs:{id:"区块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#区块"}},[s._v("#")]),s._v(" 区块")]),s._v(" "),n("ul",[n("li",[s._v("背景：所谓区块链，简单来说就是不同的区块以DAG方式链接起来形成的链。因此，区块是区块链的基本单元。")]),s._v(" "),n("li",[s._v("功能：区块是区块链的基本单元，通常为了提高区块链网络的吞吐，矿工会在一个区块中打包若干个交易。一个区块通常由区块头以及区块体组成。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(357),alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("代码：区块的Proto如下")])]),s._v(" "),n("div",{staticClass:"language-protobuf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-protobuf"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InternalBlock")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// block version")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块版本")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Random number used to avoid replay attacks")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 随机数，用来避免重放攻击")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" nonce "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// blockid generate the hash sign of the block used by sha256")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块的唯一标识")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" blockid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// pre_hash is the parent blockid of the block")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块的前置依赖区块ID")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" pre_hash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The miner id")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 矿工ID")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" proposer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 矿工对区块的签名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The sign which miner signed: blockid + nonce + timestamp")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" sign "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The pk of the miner")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 矿工公钥")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" pubkey "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The Merkle Tree root")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默克尔树树根")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" merkle_root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The height of the blockchain")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块所在高度")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" height "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Timestamp of the block")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打包区块的时间戳")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Transactions of the block, only txid stored on kv, the detail information")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// stored in another table")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易内容")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("Transaction")]),s._v(" transactions "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The transaction count of the block")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块中包含的交易数量")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" tx_count "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 所有交易hash的merkle tree")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" merkle_tree "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 采用DPOS共识算法时，当前是第几轮")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" curTerm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" curBlockNum "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 区块中执行失败的交易以及对应的失败原因")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token map class-name"}},[s._v("map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" failed_txs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// txid -> failed reason")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 采用POW共识算法时，对应的挖矿难度值")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" targetBits "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下面的属性会动态变化")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// If the block is on the trunk")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该区块是否在主干上")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v(" in_trunk "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Next next block which on trunk")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前区块的后继区块ID")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" next_hash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("h3",{attrs:{id:"交易"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易"}},[s._v("#")]),s._v(" 交易")]),s._v(" "),n("ul",[n("li",[s._v("背景：区块链网络中的每个节点都是一个状态机，为了给每个节点传递状态，系统引入了交易，作为区块链网络状态更改的最小操作单元。")]),s._v(" "),n("li",[s._v("功能：通常表现为普通转账以及智能合约调用。")]),s._v(" "),n("li",[s._v("代码：交易的Proto如下")])]),s._v(" "),n("div",{staticClass:"language-protobuf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-protobuf"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transaction")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// txid is the id of this transaction")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易的唯一标识")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" txid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// the blockid the transaction belong to")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易被打包在哪个区块中")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" blockid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Transaction input list")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO来源")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("TxInput")]),s._v(" tx_inputs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Transaction output list")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO去处")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("TxOutput")]),s._v(" tx_outputs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Transaction description or system contract")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易内容描述或系统合约")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" desc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Mining rewards")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 矿工奖励")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v(" coinbase "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Random number used to avoid replay attacks")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 随机数")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" nonce "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Timestamp to launch the transaction")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发起交易的时间戳")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// tx format version; tx格式版本号")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// auto generated tx")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该交易是否属于系统自动生成的交易")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v(" autogen "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读写集中的读集")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("TxInputExt")]),s._v(" tx_inputs_ext "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读写集中的写集")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("TxOutputExt")]),s._v(" tx_outputs_ext "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该交易包含的合约调用请求")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("InvokeRequest")]),s._v(" contract_requests "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 权限系统新增字段")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易发起者, 可以是一个Address或者一个Account")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" initiator "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易发起需要被收集签名的AddressURL集合信息，包括用于utxo转账和用于合约调用")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" auth_require "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 交易发起者对交易元数据签名，签名的内容包括auth_require字段")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("SignatureInfo")]),s._v(" initiator_signs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 收集到的签名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("SignatureInfo")]),s._v(" auth_require_signs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 节点收到tx的时间戳，不参与签名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" received_timestamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 统一签名(支持多重签名/环签名等，与initiator_signs/auth_require_signs不同时使用)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("XuperSignature")]),s._v(" xuper_sign "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("h3",{attrs:{id:"utxo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#utxo"}},[s._v("#")]),s._v(" UTXO")]),s._v(" "),n("ul",[n("li",[s._v("背景：区块链中比较常见的两种操作，包括普通转账以及合约调用，这两种操作都涉及到了数据状态的引用以及更新。为了描述普通转账涉及到的数据状态的引用以及更新，引入了UTXO(Unspent Transaction Output)。")]),s._v(" "),n("li",[s._v("功能：一种记账方式，用来描述普通转账时涉及到的数据状态的引用以及更新。通常由转账来源数据(UtxoInput)以及转账去处数据(UtxoOutput)组成。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(358),alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("代码：UTXO的Proto如下")])]),s._v(" "),n("div",{staticClass:"language-protobuf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-protobuf"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Utxo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转账数量")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" amount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转给谁")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" toAddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转给谁的公钥")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" toPubkey "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该Utxo属于哪一个交易")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" refTxid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该Utxo数据哪一个交易的哪一个offset")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" refOffset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UtxoInput query info to query utxos")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO的转账来源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UtxoInput")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("Header")]),s._v(" header "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// which bcname to select")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO来源属于哪一条链")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" bcname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// address to select")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO来源属于哪个address")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" address "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// publickey of the address")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO来源对应的公钥")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" publickey "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// totalNeed refer the total need utxos to select")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 需要的UTXO总额")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" totalNeed "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// userSign of input")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO来源的签名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" userSign "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// need lock")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 该UTXO是否需要锁定(内存级别锁定)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v(" needLock "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UtxoOutput query results")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO的转账去处")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UtxoOutput")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("Header")]),s._v(" header "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// utxo list")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO去处")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("repeated")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[s._v("Utxo")]),s._v(" utxoList "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// total selected amount")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// UTXO去处总额")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" totalSelected "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("h3",{attrs:{id:"读写集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读写集"}},[s._v("#")]),s._v(" 读写集")]),s._v(" "),n("ul",[n("li",[s._v("背景：区块链中比较常见的两种操作，包括普通转账以及合约调用，这两种操作都涉及到了数据状态的引用以及更新。为了描述合约调用涉及到的数据状态的引用以及更新，引入了读写集。")]),s._v(" "),n("li",[s._v("功能：一种用来描述合约调用时涉及到的数据状态的引用以及更新的技术。通常由读集(TxInputExt)以及写集(TxOutputExt)组成。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(359),alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("代码：读写集的Proto如下")])]),s._v(" "),n("div",{staticClass:"language-protobuf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-protobuf"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 扩展输入")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxInputExt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读集属于哪一个bucket")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" bucket "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读集对应的key")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读集属于哪一个txid")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" ref_txid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读集属于哪一个txid的哪一个offset")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int32")]),s._v(" ref_offset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 扩展输出")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("message")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TxOutputExt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写集属于哪一个bucket")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" bucket "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写集对应的key")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写集对应的value")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bytes")]),s._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);